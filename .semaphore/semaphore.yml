version: v1.0
name: First pipeline example
agent:
  machine:
    type: e1-standard-8
    os_image: ubuntu1804
execution_time_limit:
  hours: 5
blocks:
  - name: "Build"
    task:
      env_vars:
        - name: APP_ENV
          value: prod
        - name: SRC
          value: .
        - name: NO_CCACHE
          value: "1"
      jobs:
      - name: Build rustc
        commands:
          - cache list
          - cache restore llvm-bin
          - cache restore llvm-include
          - cache restore llvm-lib
          - cache restore llvm-touch
          - git clone --depth 2 -b sem2 --single-branch $SEMAPHORE_GIT_URL $SEMAPHORE_GIT_DIR
          - cd $SEMAPHORE_GIT_DIR
          - ./sem.sh
          - ./src/ci/run.sh
          - ./x.py dist
          - cache store llvm-bin $SEMAPHORE_GIT_DIR/build/x86_64-unknown-linux-gnu/llvm/bin
          - cache store llvm-include $SEMAPHORE_GIT_DIR/build/x86_64-unknown-linux-gnu/llvm/include
          - cache store llvm-lib $SEMAPHORE_GIT_DIR/build/x86_64-unknown-linux-gnu/llvm/lib
          - cache store llvm-touch $SEMAPHORE_GIT_DIR/build/x86_64-unknown-linux-gnu/llvm/llvm-finished-building